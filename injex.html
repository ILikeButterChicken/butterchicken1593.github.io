<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Injex Launcher</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet" />
    <style>
      :root {
        --bg: #0f0f0f;
        --panel: #181818;
        --panel2: #121212;
        --txt: #fff;
        --glow: #ff8c00;
      }
      * {
        box-sizing: border-box;
        font-family: "Nunito", system-ui, -apple-system, Segoe UI, Arial, sans-serif;
      }
      html,
      body {
        height: 100%;
        margin: 0;
      }
      body {
        background-color: var(--bg);
        background-size: 40px 40px;
        background-image: radial-gradient(circle at center, #171717 3px, transparent 0);
        color: var(--txt);
        display: grid;
        place-items: center;
        overflow: hidden;
      }
      #wrap {
        display: grid;
        gap: 16px;
        place-items: center;
      }
      #card {
        display: grid;
        gap: 14px;
        justify-items: center;
        padding: 28px;
        min-width: 340px;
        background: linear-gradient(180deg, var(--panel), var(--panel2));
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 16px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.55), 0 0 0 1px rgba(0, 0, 0, 0.35);
        text-align: center;
      }
      #spinner {
        width: 64px;
        height: 64px;
        border: 8px solid rgba(255, 255, 255, 0.06);
        border-top: 8px solid var(--glow);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(1turn);
        }
      }
      h1 {
        margin: 0;
        font-size: 18px;
        letter-spacing: 0.2px;
      }
      p {
        margin: 0;
        opacity: 0.9;
      }
      .row {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
      }
      .btn {
        padding: 10px 16px;
        border-radius: 10px;
        background: linear-gradient(180deg, rgba(255, 140, 0, 0.15), rgba(255, 140, 0, 0.06));
        border: 1px solid rgba(255, 140, 0, 0.22);
        color: var(--txt);
        font-weight: 700;
        cursor: pointer;
        transition: 0.2s;
      }
      .btn:hover {
        filter: brightness(1.3);
      }
      .btn:active {
        transform: translateY(1px);
      }
      .switch {
        --w: 56px;
        --h: 30px;
        --pad: 3px;
        display: inline-grid;
        align-items: center;
        grid-auto-flow: column;
        gap: 10px;
      }
      .switch label {
        font-size: 14px;
        opacity: 0.9;
        user-select: none;
      }
      .toggle {
        position: relative;
        width: var(--w);
        height: var(--h);
      }
      .toggle input {
        appearance: none;
        -webkit-appearance: none;
        width: 100%;
        height: 100%;
        margin: 0;
        outline: none;
        border-radius: 999px;
        background: linear-gradient(180deg, #2a2a2a, #1a1a1a);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.6);
        cursor: pointer;
        transition: 0.25s;
      }
      .toggle input:checked {
        background: linear-gradient(180deg, rgba(255, 140, 0, 0.25), rgba(255, 140, 0, 0.12));
        box-shadow: 0 0 24px rgba(255, 140, 0, 0.25), inset 0 2px 10px rgba(0, 0, 0, 0.6);
      }
      .knob {
        position: absolute;
        top: var(--pad);
        left: var(--pad);
        width: calc(var(--h) - var(--pad) * 2);
        height: calc(var(--h) - var(--pad) * 2);
        border-radius: 50%;
        background: #eee;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.6), inset 0 0 0 1px rgba(0, 0, 0, 0.25);
        transition: 0.25s;
        cursor: pointer;
        pointer-events: none;
      }
      .toggle input:checked + .knob {
        left: calc(var(--w) - var(--h) + var(--pad));
        background: #ffd6ad;
        box-shadow: 0 6px 18px rgba(255, 140, 0, 0.45), inset 0 0 0 1px rgba(255, 140, 0, 0.5);
      }
      #manual {
        display: none;
        width: 100%;
        text-align: left;
      }
      .list {
        display: grid;
        gap: 8px;
        width: 100%;
      }
      .item {
        display: flex;
        gap: 10px;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 12px;
        padding: 10px 12px;
      }
      .item .left {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .badge {
        font-size: 12px;
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        opacity: 0.9;
      }
      .badge.ok {
        border-color: rgba(0, 200, 120, 0.55);
      }
      .badge.bad {
        border-color: rgba(255, 90, 90, 0.6);
      }
      .badge.test {
        border-color: rgba(255, 180, 70, 0.7);
      }
      small {
        opacity: 0.75;
      }
      #error {
        display: none;
        color: #ff6666;
      }
      .hidden {
        display: none;
      }
      #embed {
        position: fixed;
        inset: 0;
        background: #000;
        display: none;
        z-index: 9999;
      }
      #embed iframe {
        width: 100%;
        height: 100%;
        border: 0;
        display: block;
      }
      @keyframes fade {
        0%,
        100% {
          background-color: rgba(255, 255, 255, 0.03);
        }
        50% {
          background-color: #333;
        }
      }
    </style>
  </head>
  <body>
    <div id="wrap">
      <div id="card" role="status" aria-live="polite">
        <div id="spinner"></div>
        <h1 id="title">Testing servers</h1>
        <p id="status">Please waitâ€¦</p>
        <div class="row hidden" id="autoRow">
          <button class="btn" id="openNow" type="button">Open now</button>
        </div>
        <div class="switch">
          <div class="toggle"><input id="toggleManual" type="checkbox" /><span class="knob"></span></div>
          <label for="toggleManual">Manual mode</label>
        </div>
        <div id="manual">
          <div class="list" id="serverList"></div>
          <div id="error">All proxy servers appear blocked.</div>
          <small>You can try any server even if marked blocked.</small>
        </div>
      </div>
    </div>
    <div id="embed"><iframe id="embedFrame"></iframe></div>
    <script>
      (function () {
        var mirrors = [
          "https://8021688600113732413547102395624276084104729385610293875616.estoniaeducation.info/",
          "https://8021688600113732413547102395624276084104729385613928573282.educationandtraining.info/",
          "https://8021688600113732483727102395624276084104729385610293875616.foothillsbible.org/",
          "https://8021688600113732413547102395624276482734729385610293875616.smarthomesllc.org/",
          "https://8021688600113732413547102302937276084104729385610293875616.wilcorw.org/",
          "https://8021688600113732413547102395624276084104208565610293875616.alertconference.org/",
        ];
        var expectedTitle = "Injex";
        var spinner = document.getElementById("spinner");
        var title = document.getElementById("title");
        var status = document.getElementById("status");
        var autoRow = document.getElementById("autoRow");
        var openNow = document.getElementById("openNow");
        var toggle = document.getElementById("toggleManual");
        var manual = document.getElementById("manual");
        var list = document.getElementById("serverList");
        var listDivs = list.getElementsByClassName("item");
        var errorEl = document.getElementById("error");
        var results = mirrors.map((u, i) => ({
          label: "Server " + (i + 1),
          origin: u,
          status: "testing",
        }));
        var tokens = mirrors.map(() => Math.random().toString(36).slice(2));
        var timers = new Array(mirrors.length).fill(null);
        var frames = new Array(mirrors.length).fill(null);
        var firstOrigin = null;
        var embed = document.getElementById("embed");
        var embedFrame = document.getElementById("embedFrame");
        function openEmbed(url) {
          embedFrame.src = url;
          embed.style.display = "block";
        }
        function render() {
          list.innerHTML = "";
          var anyU = false,
            anyT = false,
            anyB = false;
          results.forEach((r) => {
            var row = document.createElement("div");
            row.className = "item";
            var left = document.createElement("div");
            left.className = "left";
            var name = document.createElement("strong");
            name.textContent = r.label;
            var badge = document.createElement("span");
            badge.className = "badge " + (r.status === "unblocked" ? "ok" : r.status === "blocked" ? "bad" : "test");
            badge.textContent = r.status === "unblocked" ? "Unblocked" : r.status === "blocked" ? "Blocked" : "Testing";
            left.appendChild(name);
            left.appendChild(badge);
            var btn = document.createElement("button");
            btn.type = "button";
            btn.className = "btn";
            btn.textContent = "Open";
            btn.onclick = function () {
              openEmbed(r.origin);
            };
            row.appendChild(left);
            row.appendChild(btn);
            list.appendChild(row);
            anyU = anyU || r.status === "unblocked";
            anyB = anyB || r.status === "blocked";
            anyT = anyT || r.status === "testing";
          });
          errorEl.style.display = !anyU && !anyT && anyB ? "block" : "none";
        }
        function cleanupOne(i) {
          if (timers[i]) {
            clearTimeout(timers[i]);
            timers[i] = null;
          }
          if (frames[i]) {
            frames[i].remove();
            frames[i] = null;
          }
        }
        function allFinished() {
          return results.every((r) => r.status !== "testing");
        }
        function finalizeIfDone() {
          if (allFinished() && !firstOrigin) {
            spinner.classList.add("hidden");
            title.textContent = "No unblocked server found";
            status.textContent = "Try manual mode below";
            errorEl.style.display = "block";
          }
        }
        function startTests() {
          var timeoutMs = 1800;
          mirrors.forEach(function (host, i) {
            var f = document.createElement("iframe");
            f.style.display = "none";
            document.body.appendChild(f);
            frames[i] = f;
            timers[i] = setTimeout(function () {
              results[i].status = "blocked";
              render();
              cleanupOne(i);
              finalizeIfDone();
            }, timeoutMs);
            var u = new URL(host);
            u.hash = "injex=" + tokens[i];
            f.src = u.toString();
          });
        }
        window.addEventListener("message", function (e) {
          var d = e.data || {};
          if (d.type !== "injex:ready") return;
          if (d.title !== expectedTitle) return;
          var idx = tokens.indexOf(d.token);
          if (idx < 0) return;
          cleanupOne(idx);
          var origin = new URL(mirrors[idx]).origin + "/";
          results[idx].status = "unblocked";
          results[idx].origin = origin;
          render();
          if (!firstOrigin) {
            firstOrigin = origin;
            spinner.classList.add("hidden");
            title.textContent = "Unblocked server found!";
            status.textContent = "Ready to launch";
            autoRow.classList.remove("hidden");
          }
          finalizeIfDone();
        });
        openNow.onclick = function () {
          if (firstOrigin) openEmbed(firstOrigin);
        };
        function applyManualVisibility() {
          const checked = toggle.checked;
          manual.style.display = checked ? "block" : "none";
          localStorage.setItem("injex_manual_mode", checked ? "1" : "0");
          if (checked) serverListWaveEffect();
        }
        var saved = localStorage.getItem("injex_manual_mode");
        if (saved === "1") {
          toggle.checked = true;
        }
        applyManualVisibility();
        toggle.onchange = applyManualVisibility;
        render();
        startTests();

        // Visual effects
        function serverListWaveEffect() {
          [...listDivs].forEach((div, i) => {
            div.style.animation = `fade 0.4s forwards`;
            div.style.animationDelay = `${i * 0.03 + 0.3}s`;
          });
        }
      })();
    </script>
  </body>
</html>
